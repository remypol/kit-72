---
/**
 * LanguageSwitcher Component
 *
 * Displays a dropdown or inline language selector for switching between locales.
 * Can be used in header or footer.
 */

type Locale = 'es' | 'nl' | 'de';

interface Props {
  /** Current page locale */
  locale: Locale;
  /** Alternate URLs for other languages (if known) */
  alternates?: Partial<Record<Locale, string>>;
  /** Display variant */
  variant?: 'dropdown' | 'inline' | 'flags';
}

const { locale, alternates = {}, variant = 'dropdown' } = Astro.props;

interface LanguageOption {
  code: Locale;
  name: string;
  flag: string;
  href: string;
  isCurrent: boolean;
  isAvailable: boolean;
}

// Language configuration
const languageConfig: Record<Locale, { name: string; flag: string }> = {
  es: { name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
  nl: { name: 'Nederlands', flag: 'ðŸ‡³ðŸ‡±' },
  de: { name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
};

// Build language options
const languages: LanguageOption[] = (['es', 'nl', 'de'] as Locale[]).map(code => ({
  code,
  name: languageConfig[code].name,
  flag: languageConfig[code].flag,
  href: alternates[code] || `/${code}/`,
  isCurrent: code === locale,
  // All languages are now available
  isAvailable: true,
}));

const currentLang = languages.find(l => l.isCurrent) || languages[0];
---

{variant === 'dropdown' && (
  <div class="relative group">
    <button
      type="button"
      class="flex items-center gap-2 px-3 py-2 text-sm text-[--color-text-secondary] hover:text-[--color-text-primary] hover:bg-[--color-bg-secondary] rounded transition-colors"
      aria-haspopup="true"
      aria-expanded="false"
      aria-label={`Current language: ${currentLang.name}. Select a different language.`}
    >
      <span class="text-base">{currentLang.flag}</span>
      <span class="hidden sm:inline">{currentLang.code.toUpperCase()}</span>
      <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>
    <div class="absolute right-0 top-full mt-1 w-40 py-2 bg-[#1a1d23] border border-[--color-border] rounded-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150 z-50">
      {languages.map(lang => (
        <a
          href={lang.href}
          class:list={[
            'flex items-center gap-3 px-4 py-2 text-sm transition-colors',
            lang.isCurrent
              ? 'text-[--color-accent-primary] bg-[--color-accent-subtle]'
              : lang.isAvailable
                ? 'text-[--color-text-secondary] hover:text-[--color-text-primary] hover:bg-[--color-bg-elevated]'
                : 'text-[--color-text-tertiary] opacity-50 pointer-events-none'
          ]}
          aria-current={lang.isCurrent ? 'page' : undefined}
          hreflang={lang.code}
        >
          <span class="text-lg">{lang.flag}</span>
          <span>{lang.name}</span>
          {!lang.isAvailable && <span class="text-xs">(soon)</span>}
        </a>
      ))}
    </div>
  </div>
)}

{variant === 'inline' && (
  <div class="flex items-center gap-2 text-sm">
    {languages.map((lang, index) => (
      <>
        {index > 0 && <span class="text-[--color-text-tertiary]">|</span>}
        {lang.isCurrent ? (
          <span class="text-[--color-text-primary] font-medium">{lang.code.toUpperCase()}</span>
        ) : lang.isAvailable ? (
          <a
            href={lang.href}
            class="text-[--color-text-secondary] hover:text-[--color-accent-primary] transition-colors"
            hreflang={lang.code}
          >
            {lang.code.toUpperCase()}
          </a>
        ) : (
          <span class="text-[--color-text-tertiary] opacity-50">{lang.code.toUpperCase()}</span>
        )}
      </>
    ))}
  </div>
)}

{variant === 'flags' && (
  <div class="flex items-center gap-1">
    {languages.map(lang => (
      <a
        href={lang.href}
        class:list={[
          'p-1.5 rounded transition-all',
          lang.isCurrent
            ? 'bg-[--color-accent-subtle] ring-2 ring-[--color-accent-primary]'
            : lang.isAvailable
              ? 'hover:bg-[--color-bg-secondary] opacity-70 hover:opacity-100'
              : 'opacity-30 pointer-events-none'
        ]}
        aria-label={lang.name}
        aria-current={lang.isCurrent ? 'page' : undefined}
        hreflang={lang.code}
        title={lang.isAvailable ? lang.name : `${lang.name} (coming soon)`}
      >
        <span class="text-xl">{lang.flag}</span>
      </a>
    ))}
  </div>
)}

<style>
  /* Keep dropdown open when hovering from trigger to dropdown */
  .group:hover > div:last-child {
    opacity: 1;
    visibility: visible;
  }
</style>

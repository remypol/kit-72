---
/**
 * ArticleMeta Component
 *
 * Displays article metadata for trust signals and freshness:
 * - Last updated date
 * - Author/reviewer info
 * - Reading time estimate
 *
 * Important for both users and AI systems evaluating content quality.
 */

interface Props {
  /** Last updated date (ISO format or readable string) */
  dateModified?: string;
  /** Original publish date */
  datePublished?: string;
  /** Author name */
  author?: string;
  /** Reviewer name (for medical/safety content) */
  reviewer?: string;
  /** Estimated reading time in minutes */
  readingTime?: number;
  /** Show compact version */
  compact?: boolean;
}

const {
  dateModified,
  datePublished,
  author = 'Equipo Kit-72',
  reviewer,
  readingTime,
  compact = false,
} = Astro.props;

// Format dates for display
const formatDate = (dateStr: string | undefined) => {
  if (!dateStr) return null;
  try {
    const date = new Date(dateStr);
    return date.toLocaleDateString('es-ES', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });
  } catch {
    return dateStr;
  }
};

const formattedModified = formatDate(dateModified);
const formattedPublished = formatDate(datePublished);
---

{compact ? (
  <div class="article-meta-compact">
    {formattedModified && (
      <span class="meta-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M12 8v4l3 3"/>
          <circle cx="12" cy="12" r="10"/>
        </svg>
        Actualizado: {formattedModified}
      </span>
    )}
    {readingTime && (
      <span class="meta-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
        {readingTime} min de lectura
      </span>
    )}
  </div>
) : (
  <div class="article-meta">
    <div class="meta-row">
      {formattedModified && (
        <div class="meta-block">
          <span class="meta-label">Última actualización</span>
          <time datetime={dateModified} class="meta-value">{formattedModified}</time>
        </div>
      )}
      {formattedPublished && !formattedModified && (
        <div class="meta-block">
          <span class="meta-label">Publicado</span>
          <time datetime={datePublished} class="meta-value">{formattedPublished}</time>
        </div>
      )}
      {readingTime && (
        <div class="meta-block">
          <span class="meta-label">Tiempo de lectura</span>
          <span class="meta-value">{readingTime} minutos</span>
        </div>
      )}
    </div>

    {(author || reviewer) && (
      <div class="meta-row meta-authors">
        {author && (
          <div class="meta-block">
            <span class="meta-label">Autor</span>
            <span class="meta-value">{author}</span>
          </div>
        )}
        {reviewer && (
          <div class="meta-block">
            <span class="meta-label">Revisado por</span>
            <span class="meta-value">{reviewer}</span>
          </div>
        )}
      </div>
    )}

    <div class="meta-trust">
      <a href="/es/politica-editorial/" class="trust-link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
          <path d="m9 12 2 2 4-4"/>
        </svg>
        Ver política editorial
      </a>
    </div>
  </div>
)}

<style>
  .article-meta-compact {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    font-size: 13px;
    color: var(--color-text-muted);
    margin-bottom: 16px;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .meta-item svg {
    opacity: 0.7;
  }

  .article-meta {
    background: var(--color-bg-secondary);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 24px;
  }

  .meta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
  }

  .meta-row + .meta-row {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--color-border-subtle);
  }

  .meta-block {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .meta-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    color: var(--color-text-tertiary);
  }

  .meta-value {
    font-size: 14px;
    color: var(--color-text-primary);
  }

  .meta-trust {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--color-border-subtle);
  }

  .trust-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .trust-link:hover {
    color: var(--color-accent-primary);
  }

  @media (max-width: 640px) {
    .article-meta {
      padding: 12px;
    }

    .meta-row {
      gap: 16px;
    }
  }
</style>

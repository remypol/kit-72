---
/**
 * ProductCard Component for MDX
 * Embedded product recommendation with affiliate link
 */
import Icon from '../ui/Icon.astro';

interface Props {
  name: string;
  description?: string;
  price?: string;
  rating?: number;
  features?: string[];
  amazonUrl: string;
  badge?: 'recommended' | 'best-value' | 'premium';
  image?: string;
}

const {
  name,
  description,
  price,
  rating,
  features = [],
  amazonUrl,
  badge,
  image,
} = Astro.props;

const badgeStyles = {
  recommended: { text: 'Recomendado', class: 'bg-green-500/20 text-green-400 border-green-500/30' },
  'best-value': { text: 'Mejor precio', class: 'bg-amber-500/20 text-amber-400 border-amber-500/30' },
  premium: { text: 'Premium', class: 'bg-purple-500/20 text-purple-400 border-purple-500/30' },
};

// Render stars for rating
const fullStars = rating ? Math.floor(rating) : 0;
const hasHalfStar = rating ? rating % 1 >= 0.5 : false;
---

<div class="product-card card p-4 mb-4 not-prose">
  <div class="flex gap-4">
    {image && (
      <div class="w-20 h-20 flex-shrink-0 bg-[--color-bg-tertiary] rounded-lg overflow-hidden">
        <img src={image} alt={name} class="w-full h-full object-cover" loading="lazy" />
      </div>
    )}
    <div class="flex-1 min-w-0">
      <div class="flex items-start justify-between gap-2 mb-1">
        <h4 class="font-semibold text-[--color-text-primary] m-0 text-base">{name}</h4>
        {badge && (
          <span class={`text-xs px-2 py-0.5 rounded border flex-shrink-0 ${badgeStyles[badge].class}`}>
            {badgeStyles[badge].text}
          </span>
        )}
      </div>

      {description && (
        <p class="text-sm text-[--color-text-secondary] m-0 mb-2">{description}</p>
      )}

      <div class="flex items-center gap-3 flex-wrap">
        {price && (
          <span class="font-bold text-[--color-accent-primary]">{price}</span>
        )}

        {rating && (
          <div class="flex items-center gap-1">
            {[...Array(5)].map((_, i) => (
              <Icon
                name="Star"
                size={14}
                class={i < fullStars ? 'text-amber-400 fill-current' : (i === fullStars && hasHalfStar) ? 'text-amber-400' : 'text-[--color-text-muted]'}
              />
            ))}
            <span class="text-xs text-[--color-text-muted] ml-1">{rating}</span>
          </div>
        )}
      </div>

      {features.length > 0 && (
        <div class="flex flex-wrap gap-1 mt-2">
          {features.map((feature) => (
            <span class="text-xs px-2 py-0.5 bg-[--color-bg-tertiary] text-[--color-text-muted] rounded">
              {feature}
            </span>
          ))}
        </div>
      )}
    </div>
  </div>

  <a
    href={amazonUrl}
    target="_blank"
    rel="noopener sponsored"
    class="mt-3 w-full inline-flex items-center justify-center gap-2 px-4 py-2 bg-[--color-accent-primary] text-[--color-bg-primary] text-sm font-semibold rounded hover:bg-[--color-accent-hover] transition-colors"
  >
    Ver en Amazon
    <Icon name="ExternalLink" size={14} />
  </a>
</div>
